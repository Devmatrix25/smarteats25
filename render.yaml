# Render Blueprint - SmartEats Deployment
# ========================================
# Deploy with: Connect GitHub repo to Render and use this blueprint
# 
# IMPORTANT: Set these environment variables in Render Dashboard:
# - MONGODB_URI (from .env)
# - JWT_SECRET (from .env)
# - JWT_REFRESH_SECRET (from .env)
# - REDIS_URL (from .env)
# - STRIPE_SECRET_KEY (from .env)
# - All service URLs will be auto-configured

services:
  # ============ API GATEWAY (Main Entry Point) ============
  - type: web
    name: smarteats-api
    runtime: node
    region: oregon
    plan: free
    rootDir: backend/api-gateway
    buildCommand: npm install --legacy-peer-deps
    startCommand: node server.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4000
      # ===== SECRETS (Set in Render Dashboard) =====
      - key: MONGODB_URI
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: JWT_REFRESH_SECRET
        sync: false
      - key: REDIS_URL
        sync: false
      # ===== Internal Service URLs =====
      - key: AUTH_SERVICE_URL
        fromService:
          name: smarteats-auth
          type: web
          property: host
      - key: ORDER_SERVICE_URL
        fromService:
          name: smarteats-order
          type: web
          property: host
      - key: RESTAURANT_SERVICE_URL
        fromService:
          name: smarteats-restaurant
          type: web
          property: host
      - key: DELIVERY_SERVICE_URL
        fromService:
          name: smarteats-delivery
          type: web
          property: host
      - key: PAYMENT_SERVICE_URL
        fromService:
          name: smarteats-payment
          type: web
          property: host
      - key: NOTIFICATION_SERVICE_URL
        fromService:
          name: smarteats-notification
          type: web
          property: host
      - key: CORS_ORIGIN
        value: https://smarteats-frontend.vercel.app,http://localhost:5173

  # ============ AUTH SERVICE ============
  - type: web
    name: smarteats-auth
    runtime: node
    region: oregon
    plan: free
    rootDir: backend/services/auth-service
    buildCommand: npm install
    startCommand: node server.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4001
      - key: MONGODB_URI
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: JWT_REFRESH_SECRET
        sync: false
      - key: REDIS_URL
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false

  # ============ ORDER SERVICE ============
  - type: web
    name: smarteats-order
    runtime: node
    region: oregon
    plan: free
    rootDir: backend/services/order-service
    buildCommand: npm install
    startCommand: node server.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4002
      - key: MONGODB_URI
        sync: false
      - key: JWT_SECRET
        sync: false

  # ============ RESTAURANT SERVICE ============
  - type: web
    name: smarteats-restaurant
    runtime: node
    region: oregon
    plan: free
    rootDir: backend/services/restaurant-service
    buildCommand: npm install
    startCommand: node server.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4003
      - key: MONGODB_URI
        sync: false
      - key: JWT_SECRET
        sync: false

  # ============ DELIVERY SERVICE ============
  - type: web
    name: smarteats-delivery
    runtime: node
    region: oregon
    plan: free
    rootDir: backend/services/delivery-service
    buildCommand: npm install
    startCommand: node server.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4004
      - key: MONGODB_URI
        sync: false
      - key: JWT_SECRET
        sync: false

  # ============ PAYMENT SERVICE ============
  - type: web
    name: smarteats-payment
    runtime: node
    region: oregon
    plan: free
    rootDir: backend/services/payment-service
    buildCommand: npm install
    startCommand: node server.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4005
      - key: MONGODB_URI
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false

  # ============ NOTIFICATION SERVICE ============
  - type: web
    name: smarteats-notification
    runtime: node
    region: oregon
    plan: free
    rootDir: backend/services/notification-service
    buildCommand: npm install
    startCommand: node server.js
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4006
      - key: MONGODB_URI
        sync: false
      - key: FAST2SMS_API_KEY
        sync: false
      - key: SMTP_HOST
        value: smtp.gmail.com
      - key: SMTP_PORT
        value: 587
      - key: SMTP_USER
        sync: false
      - key: SMTP_PASSWORD
        sync: false
